<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€å®…ä¸€å¥ - AIé£æ°´åŠ©æ‰‹</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #c9a962;
            --primary-dark: #a8863d;
            --bg-dark: #1a1a1a;
            --bg-card: #2d2d2d;
            --bg-card-hover: #3a3a3a;
            --text: #ffffff;
            --text-muted: #bbbbbb;
            --accent-red: #d4380d;
            --border: rgba(201, 169, 98, 0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1a1a1a;
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }
        header {
            padding: 50px 20px 35px;
            text-align: center;
            background: linear-gradient(180deg, #252525 0%, #1a1a1a 100%);
            border-bottom: 1px solid var(--border);
        }
        .logo { font-size: 3rem; margin-bottom: 10px; }
        header h1 {
            font-family: 'Noto Serif SC', serif;
            font-size: 2rem;
            color: var(--text);
            margin-bottom: 8px;
            letter-spacing: 0.2em;
        }
        header p { color: var(--primary); font-size: 0.95rem; }
        .tagline { margin-top: 8px; font-size: 0.8rem; color: var(--text-muted); }
        .container { max-width: 1100px; margin: 0 auto; padding: 40px 20px 60px; }
        .section-title { text-align: center; margin-bottom: 35px; }
        .section-title h2 {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .section-title p { color: var(--text-muted); font-size: 0.85rem; }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .tool-card {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 28px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            position: relative;
        }
        .tool-card:hover {
            transform: translateY(-4px);
            background: var(--bg-card-hover);
            border-color: var(--primary);
        }
        .tool-card .icon { font-size: 2.2rem; margin-bottom: 12px; display: block; }
        .tool-card h3 { font-size: 1.1rem; color: var(--text); margin-bottom: 8px; }
        .tool-card p { color: var(--text-muted); font-size: 0.85rem; line-height: 1.6; }
        .tool-card .arrow {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            color: var(--primary);
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        .tool-card:hover .arrow { opacity: 1; right: 14px; }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow: auto;
        }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: var(--bg-card);
            max-width: 480px;
            width: 90%;
            margin: 30px auto;
            border-radius: 16px;
            padding: 28px;
            border: 1px solid var(--border);
        }
        /* æ‚¬æµ®æŒ‰é’® */
        .float-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(201, 169, 98, 0.4);
            z-index: 999;
            transition: transform 0.3s;
        }
        .float-btn:hover { transform: scale(1.1); }
        .top-btn { position: fixed; bottom: 100px; right: 30px; width: 50px; height: 50px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 998; opacity: 0.7; }
        .top-btn:hover { opacity: 1; border-color: var(--primary); }
        /* AIå®¢æœèŠå¤©çª—å£ */
        .chat-modal { display: none; position: fixed; bottom: 100px; right: 30px; width: 340px; background: var(--bg-card); border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); z-index: 1000; border: 1px solid var(--border); }
        .chat-modal.active { display: block; }
        .chat-header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .chat-header span { color: var(--primary); font-weight: 500; }
        .chat-close { margin-left: auto; cursor: pointer; color: var(--text-muted); }
        .chat-messages { height: 280px; overflow-y: auto; padding: 15px; }
        .chat-msg { margin-bottom: 12px; font-size: 0.9rem; line-height: 1.5; }
        .chat-msg.bot { color: var(--text); background: var(--bg-card); padding: 10px 14px; border-radius: 14px 14px 14px 4px; }
        .chat-msg.user { color: var(--primary); text-align: right; background: var(--bg-dark); padding: 10px 14px; border-radius: 14px 14px 4px 14px; display: inline-block; align-self: flex-end; }
        .chat-options { padding: 10px 15px; border-top: 1px solid var(--border); display: flex; flex-wrap: wrap; gap: 8px; }
        .chat-opt { background: var(--bg-dark); border: 1px solid var(--border); color: var(--text); padding: 8px 14px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; }
        .chat-opt:hover { border-color: var(--primary); }
        /* å¼•å¯¼å¼¹çª— */
        .lead-popup {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .lead-popup.active { display: flex; }
        .lead-box {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            border: 2px solid var(--primary);
            max-width: 360px;
        }
        .lead-box h3 { color: var(--primary); margin-bottom: 15px; font-size: 1.2rem; }
        .lead-box p { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px; }
        .lead-btn {
            display: inline-block;
            background: var(--primary);
            color: #111;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
        }
        .lead-close { margin-top: 15px; color: var(--text-muted); font-size: 0.85rem; cursor: pointer; }
        .modal-close {
            position: absolute;
            top: 14px; right: 14px;
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--text-muted);
            border-radius: 50%;
        }
        .modal-close:hover { background: var(--bg-card-hover); color: var(--text); }
        .modal h2 { font-family: 'Noto Serif SC', serif; color: var(--primary); margin-bottom: 20px; font-size: 1.2rem; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.85rem; }
        .form-group select, .form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-dark);
            color: var(--text);
            font-size: 0.95rem;
        }
        .form-group select:focus, .form-group input:focus { outline: none; border-color: var(--primary); }
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            color: #111;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
        }
        .btn:hover { opacity: 0.9; }
        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 35px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
        }
        .upload-area:hover { border-color: var(--primary); }
        .result {
            margin-top: 18px;
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 18px;
            display: none;
        }
        .result.active { display: block; }
        .result h4 { color: var(--primary); margin-bottom: 12px; font-size: 0.95rem; }
        .result ul { list-style: none; }
        .result li { padding: 8px 0; border-bottom: 1px solid var(--border); color: var(--text-muted); font-size: 0.85rem; }
        .result li:last-child { border: none; }
        .result li strong { color: var(--text); }
        .tips {
            background: rgba(201, 169, 98, 0.15);
            border-left: 3px solid var(--primary);
            padding: 12px 15px;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
            color: var(--text-muted);
            font-size: 0.8rem;
        }
        .loading { text-align: center; padding: 30px; display: none; }
        .loading.active { display: block; }
        .spinner {
            width: 36px; height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        footer { text-align: center; padding: 30px 20px; border-top: 1px solid var(--border); }
        footer p { color: var(--text-muted); font-size: 0.8rem; }
        footer .brand { color: var(--primary); font-family: 'Noto Serif SC', serif; margin-bottom: 5px; }
        @media (max-width: 600px) {
            header h1 { font-size: 1.6rem; }
            .tools-grid { grid-template-columns: 1fr; }
        }
    </style>
    
    <!-- ç™»å½•å¼¹çª— -->
    <div id="login-modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:3000;align-items:center;justify-content:center;">
        <div style="background:var(--bg-card);border-radius:16px;padding:30px;max-width:360px;width:90%;border:2px solid var(--primary);">
            <h3 style="color:var(--primary);margin-bottom:20px;text-align:center;">ğŸ‘¤ ç”¨æˆ·ç™»å½•</h3>
            <div style="margin-bottom:15px;">
                <input type="text" id="login-wechat" placeholder="è¯·è¾“å…¥å¾®ä¿¡ID" style="width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);background:var(--bg-dark);color:var(--text);">
            </div>
            <button onclick="doLogin()" style="width:100%;padding:12px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:600;cursor:pointer;margin-bottom:10px;">ç™»å½• / æ³¨å†Œ</button>
            <button onclick="document.getElementById('login-modal').style.display='none'" style="width:100%;padding:10px;background:transparent;border:1px solid var(--border);border-radius:8px;color:var(--text-muted);cursor:pointer;">å–æ¶ˆ</button>
            <p id="login-msg" style="margin-top:15px;font-size:0.85rem;color:var(--text-muted);text-align:center;"></p>
        </div>
    </div>
    
    <script>
    // Supabaseé…ç½®
    const SUPABASE_URL = 'https://fugdohvvjqwwobdkfsii.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1Z2RvaHZ2anF3d29iZGtmc2lpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNDA4NzcsImV4cCI6MjA4NjcxNjg3N30.SY3WYl8ElSQS0pdER5uV8VU9j6Dh5GM6MTU9MEuOroM';
    
    // åˆå§‹åŒ–Supabase
    const { createClient } = window.supabase || {};
    let supabase = null;
    if(createClient) supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // ç™»å½•ç›¸å…³
    function openLogin() {
        document.getElementById('login-modal').style.display = 'flex';
    }
    
    async function doLogin() {
        const wechatId = document.getElementById('login-wechat').value.trim();
        if(!wechatId) return document.getElementById('login-msg').innerText = 'è¯·è¾“å…¥å¾®ä¿¡ID';
        
        document.getElementById('login-msg').innerText = 'ç™»å½•ä¸­...';
        
        // æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
        let { data: users } = await supabase.from('users').select('*').eq('wechat_id', wechatId);
        
        if(users && users.length > 0) {
            // å·²å­˜åœ¨ï¼Œç™»å½•
            localStorage.setItem('fengshui_user', JSON.stringify(users[0]));
            document.getElementById('login-msg').innerText = 'âœ… ç™»å½•æˆåŠŸï¼';
            setTimeout(() => location.reload(), 1000);
        } else {
            // æ–°ç”¨æˆ·æ³¨å†Œ
            const { data, error } = await supabase.from('users').insert([{ wechat_id: wechatId }]).select();
            if(error) {
                document.getElementById('login-msg').innerText = 'âŒ æ³¨å†Œå¤±è´¥ï¼š' + error.message;
            } else {
                localStorage.setItem('fengshui_user', JSON.stringify(data[0]));
                document.getElementById('login-msg').innerText = 'âœ… æ³¨å†ŒæˆåŠŸï¼';
                setTimeout(() => location.reload(), 1000);
            }
        }
    }
    
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    function getUser() {
        const u = localStorage.getItem('fengshui_user');
        return u ? JSON.parse(u) : null;
    }
    
    // ä»æœåŠ¡å™¨æ£€æŸ¥ä»˜è´¹çŠ¶æ€
    async function checkPaidFromServer() {
        const user = getUser();
        if (!user || !user.id) return false;
        
        const { data } = await supabase
            .from('users')
            .select('is_paid')
            .eq('id', user.id)
            .single();
        
        return data ? data.is_paid : false;
    }
    </script>
</head>
<body>
    <header>
        <div class="logo">ğŸ®</div>
        <h1>ä¸€å®…ä¸€å¥</h1>
        <p>ç§‘å­¦é£æ°´ Â· AIèµ‹èƒ½</p>
        <p class="tagline">ä¸åŠè¿·ä¿¡ï¼Œåªè®²è§è¿‡çš„äº‹</p>
        <p style="margin-top:15px;color:var(--text-muted);font-size:0.85rem;max-width:500px;margin-left:auto;margin-right:auto;">
            ğŸ”¸ çœŸå®æ°‘é—´é£æ°´æ•…äº‹ ğŸ”¸ AIæˆ·å‹åˆ†æ<br>
            ğŸ”¸ è£…ä¿®é£æ°´æŒ‡å— ğŸ”¸ 1v1æ·±åº¦å’¨è¯¢
        </p>
    </header>
    <div class="container">
        <div class="section-title">
            <h2>é£æ°´æœåŠ¡é¡¹ç›®</h2>
            <p>è¦†ç›–è´¢è¿/äº‹ä¸š/å§»ç¼˜/æˆ¿å­/é˜´å®…/æ³•äº‹</p>
        </div>
        <div class="tools-grid">
            <div class="tool-card" onclick="openModal('color')">
                <span class="icon">ğŸ’°</span>
                <h3>è´¢è¿äº‹ä¸šå’¨è¯¢</h3>
                <p>è´¢è¿æå‡/äº‹ä¸šæ–¹å‘/èŒä¸šè§„åˆ’</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('budget')">
                <span class="icon">ğŸ’•</span>
                <h3>å§»ç¼˜æ„Ÿæƒ…å’¨è¯¢</h3>
                <p>å•èº«æ‰¾å¯¹è±¡/æ„Ÿæƒ…é—®é¢˜/å©šå§»è°ƒç†</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('light')">
                <span class="icon">ğŸ¨</span>
                <h3>è£…ä¿®é£æ°´å’¨è¯¢</h3>
                <p>è£…ä¿®å¸ƒå±€/é¢œè‰²æ­é…/é—¨ç¶å•è®¾è®¡</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('floorplan')">
                <span class="icon">ğŸ </span>
                <h3>æˆ·å‹/é˜³å®…åˆ†æ</h3>
                <p>å‘é€æˆ·å‹å›¾ï¼Œè¯¦ç»†åˆ†æé£æ°´æ ¼å±€</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('talisman')">
                <span class="icon">ğŸ“¿</span>
                <h3>è¯·ç¬¦/è¯·ç‰©</h3>
                <p>å¤ªå²ç¬¦/æ‹›è´¢ç¬¦/æ¡ƒèŠ±ç¬¦/æŠ¤èº«ç¬¦</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('style')">
                <span class="icon">ğŸ”¯</span>
                <h3>é£æ°´æ³•äº‹</h3>
                <p>è¿˜é˜´å€º/è¡¥è´¢åº“/è¶…åº¦/ç¥ˆç¦è½¬è¿</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('storage')">
                <span class="icon">â›©ï¸</span>
                <h3>ç¥–åŸ/é˜´å®…é€‰å€</h3>
                <p>ç¥–åŸè¿ç§»/é˜´å®…é€‰å€/å¢“åœ°é£æ°´</p>
                <span class="arrow">â†’</span>
            </div>
            <div class="tool-card" onclick="openModal('support')">
                <span class="icon">ğŸ¯</span>
                <h3>çœŸäººä¸€å¯¹ä¸€å’¨è¯¢</h3>
                <p>ä»»ä½•é£æ°´é—®é¢˜ï¼Œèµ„æ·±é£æ°´å¸ˆè§£ç­”</p>
                <span class="arrow">â†’</span>
            </div>
        </div>
    </div>
    
    <!-- æœåŠ¡ä»·æ ¼ -->
    <div class="container" style="padding-top:20px;">
        <div class="section-title">
            <h2>ğŸ’ æœåŠ¡æŠ¥ä»·</h2>
            <p>ä¸‰ç§é€‰æ‹©ï¼ŒæŒ‰éœ€æŒ‘é€‰</p>
        </div>
        
        <!-- ä¸‰ä¸ªçº§åˆ« -->
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px;">
            <!-- çº§åˆ«1ï¼šAIå…è´¹ç­” -->
            <div style="background:var(--bg-card);border-radius:14px;padding:25px;text-align:center;border:2px solid var(--border);">
                <div style="font-size:2rem;margin-bottom:10px;">ğŸ¤–</div>
                <h3 style="color:var(--text);margin-bottom:10px;">AIå…è´¹å’¨è¯¢</h3>
                <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:15px;">é¦–é¡µå³ä¸‹è§’AIåŠ©æ‰‹<br>å¿«é€Ÿè§£ç­”åŸºç¡€é—®é¢˜</p>
                <div style="font-size:1.5rem;color:var(--text-muted);font-weight:bold;margin-bottom:15px;">å…è´¹</div>
                <button onclick="document.getElementById('chat-float-btn').click()" style="width:100%;padding:10px;background:var(--bg-dark);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;">ğŸ’¬ å¼€å§‹å’¨è¯¢</button>
            </div>
            
            <!-- çº§åˆ«2ï¼šAIè¯¦ç»†ç­” -->
            <div style="background:var(--bg-card);border-radius:14px;padding:25px;text-align:center;border:2px solid var(--primary);position:relative;">
                <div style="position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--primary);color:#111;padding:2px 12px;border-radius:10px;font-size:0.7rem;font-weight:600;">çƒ­é—¨</div>
                <div style="font-size:2rem;margin-bottom:10px;">ğŸ“–</div>
                <h3 style="color:var(--primary);margin-bottom:10px;">AIæ·±åº¦åˆ†æ</h3>
                <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:15px;">è¯¦ç»†è§£è¯»+å…·ä½“å»ºè®®<br>å«åŒ–è§£æ–¹æ¡ˆ+æ³¨æ„äº‹é¡¹</p>
                <div style="font-size:1.5rem;color:var(--primary);font-weight:bold;margin-bottom:15px;">Â¥9.9</div>
                <button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± åŠ å¾®ä¿¡è´­ä¹°</button>
            </div>
            
            <!-- çº§åˆ«3ï¼šçœŸäººæœåŠ¡ -->
            <div style="background:var(--bg-card);border-radius:14px;padding:25px;text-align:center;border:2px solid var(--border);">
                <div style="font-size:2rem;margin-bottom:10px;">ğŸ‘¨â€âš•ï¸</div>
                <h3 style="color:var(--text);margin-bottom:10px;">çœŸäºº1v1æœåŠ¡</h3>
                <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:15px;">èµ„æ·±é£æ°´å¸ˆä¸€å¯¹ä¸€<br>è¯­éŸ³/è§†é¢‘è¯¦ç»†æ²Ÿé€š</p>
                <div style="font-size:1.5rem;color:var(--text);font-weight:bold;margin-bottom:15px;">Â¥99èµ·</div>
                <button onclick="openModal('support')" style="width:100%;padding:10px;background:var(--bg-dark);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;">ğŸ“‹ é¢„çº¦å’¨è¯¢</button>
            </div>
        </div>
        
        <!-- é™„åŠ æœåŠ¡ -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
            <div style="background:var(--bg-card);border-radius:14px;padding:20px;text-align:center;border:1px solid var(--border);">
                <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ </div>
                <h3 style="color:var(--primary);margin-bottom:8px;">æˆ·å‹åˆ†æ</h3>
                <p style="color:var(--text-muted);font-size:0.8rem;margin-bottom:10px;">å‘é€æˆ·å‹å›¾<br>è¯¦ç»†é£æ°´åˆ†æ</p>
                <div style="font-size:1.3rem;color:var(--primary);font-weight:bold;margin-bottom:10px;">Â¥299</div>
                <button onclick="openModal('floorplan')" style="padding:8px 16px;background:var(--bg-dark);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">ğŸ“‹ é¢„çº¦</button>
            </div>
            <div style="background:var(--bg-card);border-radius:14px;padding:20px;text-align:center;border:1px solid var(--border);">
                <div style="font-size:1.8rem;margin-bottom:8px;">â›©ï¸</div>
                <h3 style="color:var(--primary);margin-bottom:8px;">é£æ°´æ³•äº‹</h3>
                <p style="color:var(--text-muted);font-size:0.8rem;margin-bottom:10px;">è¿˜é˜´å€º/è¡¥è´¢åº“<br>è¶…åº¦/ç¥ˆç¦è½¬è¿</p>
                <div style="font-size:1.3rem;color:var(--primary);font-weight:bold;margin-bottom:10px;">è¯·è¯¢ä»·</div>
                <button onclick="openModal('support')" style="padding:8px 16px;background:var(--bg-dark);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">ğŸ“‹ é¢„çº¦</button>
            </div>
            <div style="background:var(--bg-card);border-radius:14px;padding:20px;text-align:center;border:1px solid var(--border);">
                <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“¿</div>
                <h3 style="color:var(--primary);margin-bottom:8px;">è¯·ç¬¦/è¯·ç‰©</h3>
                <p style="color:var(--text-muted);font-size:0.8rem;margin-bottom:10px;">å¤ªå²ç¬¦/æ‹›è´¢ç¬¦<br>æ¡ƒèŠ±ç¬¦/æŠ¤èº«ç¬¦</p>
                <div style="font-size:1.3rem;color:var(--primary);font-weight:bold;margin-bottom:10px;">Â¥99èµ·</div>
                <button onclick="openModal('talisman')" style="padding:8px 16px;background:var(--bg-dark);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;">ğŸ“‹ è¯·ç¬¦</button>
            </div>
        </div>
    </div>
    
    <!-- åšæ³•äº‹ç°åœº -->
    <div class="container" style="padding-top:20px;">
        <div class="section-title">
            <h2>ğŸ¬ åšæ³•äº‹ç°åœº</h2>
            <p>çœŸå®è®°å½•æ¯ä¸€æ¬¡ç¥ˆç¦</p>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;">
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-1.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-2.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-3.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-4.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-5.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-6.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-7.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-8.mp4" type="video/mp4">
            </video>
            <video controls style="width:100%;border-radius:10px;max-height:200px;">
                <source src="videos/ritual-9.mp4" type="video/mp4">
            </video>
        </div>
    </div>
    
    <!-- å®¢æˆ·æ¡ˆä¾‹ -->
    <div class="container" style="padding-top:20px;">
        <div class="section-title">
            <h2>ğŸ† å®¢æˆ·çœŸå®åé¦ˆ</h2>
            <p>å·²æœåŠ¡ 500+ å®¢æˆ· Â· å¥½å£ç¢‘å€¼å¾—ä¿¡èµ–</p>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;">
            <div style="background:var(--bg-card);border-radius:12px;padding:15px;text-align:center;border:1px solid var(--border);">
                <img src="images/case-1.jpg" style="width:100%;border-radius:8px;" alt="å®¢æˆ·é”¦æ——">
                <p style="margin-top:10px;font-size:0.85rem;color:var(--text-muted);">ğŸ™ è´¢è¿äº‹ä¸šå’¨è¯¢</p>
            </div>
            <div style="background:var(--bg-card);border-radius:12px;padding:15px;text-align:center;border:1px solid var(--border);">
                <img src="images/case-2.jpg" style="width:100%;border-radius:8px;" alt="å®¢æˆ·é”¦æ——">
                <p style="margin-top:10px;font-size:0.85rem;color:var(--text-muted);">ğŸ  é˜³å®…é£æ°´è°ƒç†</p>
            </div>
            <div style="background:var(--bg-card);border-radius:12px;padding:15px;text-align:center;border:1px solid var(--border);">
                <img src="images/case-3.jpg" style="width:100%;border-radius:8px;" alt="å®¢æˆ·é”¦æ——">
                <p style="margin-top:10px;font-size:0.85rem;color:var(--text-muted);">ğŸ’• å§»ç¼˜æ„Ÿæƒ…å’¨è¯¢</p>
            </div>
            <div style="background:var(--bg-card);border-radius:12px;padding:15px;text-align:center;border:1px solid var(--border);">
                <img src="images/case-4.jpg" style="width:100%;border-radius:8px;" alt="å®¢æˆ·é”¦æ——">
                <p style="margin-top:10px;font-size:0.85rem;color:var(--text-muted);">ğŸ”¯ é£æ°´æ³•äº‹</p>
            </div>
        </div>
    </div>
    
    <footer>
        <p class="brand">ä¸€å®…ä¸€å¥</p>
        <p>ç§‘å­¦é£æ°´ Â· çœŸå®æ¡ˆä¾‹ Â· ä¸“ä¸šæœåŠ¡</p>
        <p style="margin-top:8px;opacity:0.5;">å¾®ä¿¡åŒå· Â· è¯šä¿¡ç»è¥</p>
        <div style="margin-top:15px;display:flex;justify-content:center;gap:20px;font-size:0.75rem;">
            <a href="https://x.com/y5065236990506" target="_blank" style="color:var(--primary);text-decoration:none;">ğŸ¦ Twitter</a>
            <span style="color:var(--text-muted);">|</span>
            <span style="color:var(--text-muted);" id="chat-count-display">ğŸ“Š ä»Šæ—¥å¯¹è¯: åŠ è½½ä¸­...</span>
            <span style="color:var(--text-muted);">|</span>
            <a href="#" onclick="openLogin();return false;" style="color:var(--primary);text-decoration:none;">ğŸ‘¤ ç™»å½•</a>
        </div>
    </footer>
    
    <script>
    // åŠ è½½å¯¹è¯ç»Ÿè®¡
    fetch('/api/stats')
    .then(r => r.json())
    .then(d => {
        document.getElementById('chat-count-display').textContent = 'ğŸ“Š ä»Šæ—¥å¯¹è¯: ' + d.count + 'æ¬¡';
    })
    .catch(() => {
        document.getElementById('chat-count-display').textContent = 'ğŸ“Š ä»Šæ—¥å¯¹è¯: -';
    });
    </script>

    <div class="modal" id="modal-floorplan">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('floorplan')">Ã—</span>
            <h2>ğŸ  æˆ·å‹/é˜³å®…åˆ†æ</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">å‘é€æˆ·å‹å›¾ï¼Œè¯¦ç»†åˆ†æé£æ°´æ ¼å±€</p>
            <div class="upload-area" onclick="document.getElementById('floorplan-input').click()">
                <p>ğŸ“¤ ç‚¹å‡»ä¸Šä¼ æˆ·å‹å›¾</p>
                <p style="opacity:0.5;font-size:0.8rem;margin-top:5px;">æ”¯æŒ JPGã€PNG</p>
                <input type="file" id="floorplan-input" accept="image/*" style="display:none" onchange="uploadFloorplan(this)">
            </div>
            <img id="floorplan-preview" style="max-width:100%;margin:10px 0;border-radius:8px;display:none">
            <button class="btn" onclick="analyzeFloorplan()">å¼€å§‹AIåˆ†æ</button>
            <div class="result" id="floorplan-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-color">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('color')">Ã—</span>
            <h2>ğŸ’° è´¢è¿äº‹ä¸šå’¨è¯¢</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">è´¢è¿æå‡/äº‹ä¸šæ–¹å‘/èŒä¸šè§„åˆ’</p>
            <div class="form-group">
                <label>æ‚¨çš„é—®é¢˜ç±»å‹</label>
                <select id="color-room">
                    <option value="è´¢è¿æå‡">è´¢è¿æå‡</option>
                    <option value="äº‹ä¸šæ–¹å‘">äº‹ä¸šæ–¹å‘</option>
                    <option value="èŒä¸šè§„åˆ’">èŒä¸šè§„åˆ’</option>
                    <option value="åˆ›ä¸šå’¨è¯¢">åˆ›ä¸šå’¨è¯¢</option>
                    <option value="æŠ•èµ„ç†è´¢">æŠ•èµ„ç†è´¢</option>
                </select>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†æè¿°æ‚¨çš„æƒ…å†µ</label>
                <textarea id="color-style" rows="4" placeholder="è¯·æè¿°ï¼šä»äº‹è¡Œä¸š/ç›®å‰å›°å¢ƒ/å…·ä½“éœ€æ±‚..."></textarea>
            </div>
            <button class="btn" onclick="getColor()">æäº¤å’¨è¯¢</button>
            <div class="result" id="color-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-budget">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('budget')">Ã—</span>
            <h2>ğŸ’• å§»ç¼˜æ„Ÿæƒ…å’¨è¯¢</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">å•èº«æ‰¾å¯¹è±¡/æ„Ÿæƒ…é—®é¢˜/å©šå§»è°ƒç†</p>
            <div class="form-group">
                <label>æ‚¨çš„é—®é¢˜ç±»å‹</label>
                <select id="budget-area">
                    <option value="å•èº«æ‰¾å¯¹è±¡">å•èº«æ‰¾å¯¹è±¡</option>
                    <option value="ç›¸äº²æŒ‡å¯¼">ç›¸äº²æŒ‡å¯¼</option>
                    <option value="æ„Ÿæƒ…é—®é¢˜">æ„Ÿæƒ…é—®é¢˜</option>
                    <option value="å©šå§»è°ƒç†">å©šå§»è°ƒç†</option>
                    <option value="åˆ†æ‰‹æŒ½å›">åˆ†æ‰‹æŒ½å›</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ‚¨çš„æ€§åˆ«</label>
                <select id="budget-room">
                    <option value="ç”·">ç”·</option>
                    <option value="å¥³">å¥³</option>
                </select>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†æè¿°æ‚¨çš„æƒ…å†µ</label>
                <textarea id="budget-style" rows="4" placeholder="è¯·æè¿°ï¼šå¹´é¾„/å•èº«åŸå› /æ„Ÿæƒ…ç»å†/å…·ä½“éœ€æ±‚..."></textarea>
            </div>
            <button class="btn" onclick="getBudget()">æäº¤å’¨è¯¢</button>
            <div class="result" id="budget-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-storage">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('storage')">Ã—</span>
            <h2>â›©ï¸ ç¥–åŸ/é˜´å®…é€‰å€</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">ç¥–åŸè¿ç§»/é˜´å®…é€‰å€/å¢“åœ°é£æ°´</p>
            <div class="form-group">
                <label>æ‚¨çš„é—®é¢˜ç±»å‹</label>
                <select id="storage-room">
                    <option value="ç¥–åŸè¿ç§»">ç¥–åŸè¿ç§»</option>
                    <option value="é˜´å®…é€‰å€">é˜´å®…é€‰å€</option>
                    <option value="å¢“åœ°é£æ°´">å¢“åœ°é£æ°´</option>
                    <option value="è¿åŸå‰æ—¥">è¿åŸå‰æ—¥</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†æè¿°æ‚¨çš„æƒ…å†µ</label>
                <textarea id="storage-family" rows="4" placeholder="è¯·æè¿°ï¼šç°æœ‰ç¥–åŸä½ç½®/è¿ç§»åŸå› /å…·ä½“éœ€æ±‚..."></textarea>
            </div>
            <button class="btn" onclick="getStorage()">æäº¤å’¨è¯¢</button>
            <div class="result" id="storage-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-style">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('style')">Ã—</span>
            <h2>ğŸ”¯ é£æ°´æ³•äº‹</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">è¿˜é˜´å€º/è¡¥è´¢åº“/è¶…åº¦/ç¥ˆç¦è½¬è¿</p>
            <div class="form-group">
                <label>æ³•äº‹ç±»å‹</label>
                <select id="style-room">
                    <option value="è¿˜é˜´å€º">è¿˜é˜´å€º</option>
                    <option value="è¡¥è´¢åº“">è¡¥è´¢åº“</option>
                    <option value="è¶…åº¦">è¶…åº¦ï¼ˆå •èƒ/å® ç‰©/ç¥–å…ˆï¼‰</option>
                    <option value="ç¥ˆç¦è½¬è¿">ç¥ˆç¦è½¬è¿</option>
                    <option value="åŒ–å¤ªå²">åŒ–å¤ªå²</option>
                    <option value="å‚¬æ¡ƒèŠ±">å‚¬æ¡ƒèŠ±/å§»ç¼˜</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†æè¿°æ‚¨çš„æƒ…å†µ</label>
                <textarea id="style-desc" rows="4" placeholder="è¯·æè¿°ï¼šæ³•äº‹åŸå› /å…·ä½“éœ€æ±‚/æœŸæœ›æ•ˆæœ..."></textarea>
            </div>
            <button class="btn" onclick="submitStyle()">æäº¤å’¨è¯¢</button>
            <div class="result" id="style-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-light">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('light')">Ã—</span>
            <h2>ğŸ¨ è£…ä¿®é£æ°´å’¨è¯¢</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">è£…ä¿®å¸ƒå±€/é¢œè‰²æ­é…/é—¨ç¶å•è®¾è®¡</p>
            <div class="form-group">
                <label>è£…ä¿®é˜¶æ®µ</label>
                <select id="light-room">
                    <option value="è§„åˆ’è®¾è®¡">è§„åˆ’è®¾è®¡é˜¶æ®µ</option>
                    <option value="æ–½å·¥ä¸­">æ–½å·¥ä¸­</option>
                    <option value="å·²å…¥ä½">å·²å…¥ä½æƒ³è°ƒæ•´</option>
                    <option value="å‡†å¤‡è£…ä¿®">å‡†å¤‡è£…ä¿®</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ‚¨æœ€å…³å¿ƒçš„é—®é¢˜</label>
                <select id="light-orientation">
                    <option value="æ•´ä½“å¸ƒå±€">æ•´ä½“å¸ƒå±€è§„åˆ’</option>
                    <option value="é¢œè‰²æ­é…">é¢œè‰²æ­é…</option>
                    <option value="é—¨çš„ä½ç½®">é—¨çš„ä½ç½®/æœå‘</option>
                    <option value="ç¶å°ä½ç½®">ç¶å°/å¨æˆ¿ä½ç½®</option>
                    <option value="å«ç”Ÿé—´">å«ç”Ÿé—´å¸ƒå±€</option>
                    <option value="ç„å…³">ç„å…³è®¾è®¡</option>
                    <option value="å…¶ä»–">å…¶ä»–é—®é¢˜</option>
                </select>
            </div>
            <div class="form-group">
                <label>è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚</label>
                <textarea id="light-description" rows="4" placeholder="è¯·æè¿°ï¼šæˆ¿å±‹æˆ·å‹/é¢ç§¯/ç›®å‰é‡åˆ°çš„å›°æƒ‘..."></textarea>
            </div>
            <button class="btn" onclick="getLight()">æäº¤å’¨è¯¢</button>
            <div class="result" id="light-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-talisman">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('talisman')">Ã—</span>
            <h2>ğŸ“¿ è¯·ç¬¦/è¯·ç‰©</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">å¤ªå²ç¬¦/æ‹›è´¢ç¬¦/æ¡ƒèŠ±ç¬¦/æŠ¤èº«ç¬¦</p>
            <div class="form-group">
                <label>æƒ³è¯·ä»€ä¹ˆç¬¦ï¼Ÿ</label>
                <select id="talisman-type">
                    <option value="å¤ªå²ç¬¦">å¤ªå²ç¬¦ï¼ˆçŠ¯å¤ªå²ç”¨ï¼‰</option>
                    <option value="æ‹›è´¢ç¬¦">æ‹›è´¢ç¬¦ï¼ˆè´¢è¿æå‡ï¼‰</option>
                    <option value="è´¢ç¥ç¬¦">è´¢ç¥ç¬¦ï¼ˆä¾›å¥‰è´¢ç¥ï¼‰</option>
                    <option value="æ¡ƒèŠ±ç¬¦">æ¡ƒèŠ±ç¬¦ï¼ˆå§»ç¼˜çˆ±æƒ…ï¼‰</option>
                    <option value="å’Œåˆç¬¦">å’Œåˆç¬¦ï¼ˆå¤«å¦»å’Œåˆï¼‰</option>
                    <option value="æŠ¤èº«ç¬¦">æŠ¤èº«ç¬¦ï¼ˆå¹³å®‰å¥åº·ï¼‰</option>
                    <option value="æ–‡æ˜Œç¬¦">æ–‡æ˜Œç¬¦ï¼ˆå­¦ä¸šäº‹ä¸šï¼‰</option>
                    <option value="è¾Ÿé‚ªç¬¦">è¾Ÿé‚ªç¬¦ï¼ˆé•‡å®…é©±é‚ªï¼‰</option>
                    <option value="å®‰é—¨ç¬¦">å®‰é—¨ç¬¦ï¼ˆå®‰é—¨å®‰å®…ï¼‰</option>
                    <option value="è½¦å¹³å®‰ç¬¦">è½¦å¹³å®‰ç¬¦ï¼ˆè¡Œè½¦å¹³å®‰ï¼‰</option>
                    <option value="å…¶ä»–">å…¶ä»–ç¬¦</option>
                </select>
            </div>
            <div class="form-group">
                <label>æ‚¨çš„å§“å</label>
                <input type="text" id="talisman-name" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            <div class="form-group">
                <label>å‡ºç”Ÿå¹´æœˆï¼ˆç”¨äºå®šåˆ¶ï¼‰</label>
                <input type="text" id="talisman-birth" placeholder="å¦‚ï¼š1990å¹´5æœˆ">
            </div>
            <div class="form-group">
                <label>å¾®ä¿¡å·</label>
                <input type="text" id="talisman-wechat" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
            </div>
            <button class="btn" onclick="submitTalisman()">æäº¤è¯·ç¬¦</button>
            <div class="result" id="talisman-result"></div>
        </div>
    </div>

    <div class="modal" id="modal-support">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('support')">Ã—</span>
            <h2>ğŸ¯ çœŸäººä¸€å¯¹ä¸€å’¨è¯¢</h2>
            <p style="color:var(--text-muted);margin-bottom:15px;">ä»»ä½•é£æ°´é—®é¢˜ï¼Œèµ„æ·±é£æ°´å¸ˆè§£ç­”</p>
            <div class="form-group">
                <label>æ‚¨çš„å§“å</label>
                <input type="text" id="support-name" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            <div class="form-group">
                <label>å¾®ä¿¡å·ï¼ˆæ–¹ä¾¿è”ç³»ï¼‰</label>
                <input type="text" id="support-wechat" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
            </div>
            <div class="form-group">
                <label>å’¨è¯¢ç±»å‹</label>
                <select id="support-type">
                    <option value="è´¢è¿äº‹ä¸š">è´¢è¿äº‹ä¸š</option>
                    <option value="å§»ç¼˜æ„Ÿæƒ…">å§»ç¼˜æ„Ÿæƒ…</option>
                    <option value="æˆ·å‹è¯Šæ–­">æˆ·å‹è¯Šæ–­ï¼ˆç°æœ‰æˆ¿å±‹ï¼‰</option>
                    <option value="è£…ä¿®å’¨è¯¢">è£…ä¿®é£æ°´å’¨è¯¢</option>
                    <option value="é€‰å€è¯„ä¼°">é€‰å€/ä¹°æˆ¿è¯„ä¼°</option>
                    <option value="ç¥–åŸé˜´å®…">ç¥–åŸ/é˜´å®…</option>
                    <option value="é£æ°´æ³•äº‹">é£æ°´æ³•äº‹</option>
                    <option value="å…¶ä»–">å…¶ä»–é—®é¢˜</option>
                </select>
            </div>
            <div class="form-group">
                <label>ç®€è¦æè¿°é—®é¢˜</label>
                <textarea id="support-desc" rows="3" placeholder="è¯·ç®€è¦æè¿°æ‚¨çš„é£æ°´é—®é¢˜..." style="width:100%;padding:12px;border:1px solid var(--border);border-radius:10px;background:var(--bg-dark);color:var(--text);font-size:0.9rem;"></textarea>
            </div>
            <button class="btn" onclick="submitSupport()">æäº¤å’¨è¯¢</button>
            <div class="result" id="support-result"></div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>AI æ™ºèƒ½åˆ†æä¸­...</p>
    </div>

    <script>
        let floorplanFile = null;
        let styleAnswers = [];
        
        const styleQuestions = [
            {q: "ä½ æ›´å–œæ¬¢ä»€ä¹ˆæ ·çš„ç©ºé—´æ°›å›´ï¼Ÿ", options: ["ç®€æ´æ˜äº®", "æ¸©é¦¨èˆ’é€‚", "å¤§æ°”è±ªå", "æ¸…æ–°æµªæ¼«"]},
            {q: "ä½ åçˆ±çš„é¢œè‰²æ˜¯ï¼Ÿ", options: ["é»‘ç™½ç°", "åŸæœ¨è‰²", "æ·±çº¢è‰²", "æµ…è“è‰²"]},
            {q: "ä½ å–œæ¬¢çš„å®¶å…·é£æ ¼ï¼Ÿ", options: ["ç®€æ´çº¿æ¡", "è‡ªç„¶æœ¨è´¨", "ä¼ ç»Ÿé›•èŠ±", "æ›²çº¿é€ å‹"]},
            {q: "ä½ å¸Œæœ›å®¢äººè¸å…¥å®¶ä¸­çš„ç¬¬ä¸€æ„Ÿå—ï¼Ÿ", options: ["æ•´é½å¼€é˜”", "æ¸©é¦¨èˆ’é€‚", "å“è´¨é«˜ç«¯", "æ”¾æ¾èˆ’é€‚"]},
            {q: "ä½ çš„æ—¥å¸¸ç”Ÿæ´»ä¹ æƒ¯ï¼Ÿ", options: ["ç®€æ´é«˜æ•ˆ", "å®…å®¶äº«å—", "å¾…å®¢ä¸ºä¸»", "æ–‡è‰ºé˜…è¯»"]}
        ];
        
        function openModal(tool) {
            document.getElementById('modal-' + tool).classList.add('active');
            if (tool === 'style') initStyleTest();
        }
        
        function closeModal(tool) {
            document.getElementById('modal-' + tool).classList.remove('active');
        }
        
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('active');
            });
        });
        
        function uploadFloorplan(input) {
            floorplanFile = input.files[0];
            if (floorplanFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('floorplan-preview').src = e.target.result;
                    document.getElementById('floorplan-preview').style.display = 'block';
                };
                reader.readAsDataURL(floorplanFile);
            }
        }
        
        function analyzeFloorplan() {
            if (!floorplanFile) return alert('è¯·å…ˆä¸Šä¼ æˆ·å‹å›¾');
            const resultDiv = document.getElementById('floorplan-result');
            resultDiv.innerHTML = '<div style="text-align:center;padding:30px;"><div class="loading-spinner"></div><p style="margin-top:15px;">AIæ­£åœ¨åˆ†ææˆ·å‹å›¾ä¸­...</p></div>';
            resultDiv.classList.add('active');
            
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: 'æˆ·å‹é£æ°´åˆ†æ', question: 'è¯·åˆ†æè¿™ä¸ªæˆ·å‹å›¾çš„é£æ°´ï¼Œç»™å‡ºä¸“ä¸šå»ºè®®'})
            })
            .then(r => r.json())
            .then(data => {
                const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
                resultDiv.innerHTML = `<h4>ğŸ  æˆ·å‹é£æ°´åˆ†ææŠ¥å‘Š</h4><div style="margin:15px 0;padding:15px;background:var(--bg-dark);border-radius:8px;line-height:1.8;">${answer}</div><p style="color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ æƒ³äº†è§£æ›´å¤šï¼Ÿæ·»åŠ å¾®ä¿¡è·å–å®Œæ•´æŠ¥å‘Š</p><div style="margin-top:20px;padding-top:15px;border-top:1px solid var(--border);"><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ é¢†å–å®Œæ•´æŠ¥å‘Š+ã€Šé£æ°´é¿å‘æŒ‡å—ã€‹</button></div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<h4>ğŸ  æˆ·å‹é£æ°´åˆ†æ</h4><p>ç½‘ç»œé—®é¢˜ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½</p><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡</button></div>`;
            });
        }
        
        function getColor() {
            const type = document.getElementById('color-room').value;
            const desc = document.getElementById('color-style').value;
            const resultDiv = document.getElementById('color-result');
            resultDiv.innerHTML = '<div style="text-align:center;padding:30px;"><div class="loading-spinner"></div><p style="margin-top:15px;">AIæ­£åœ¨åˆ†æä¸­...</p></div>';
            resultDiv.classList.add('active');
            
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: type, question: desc})
            })
            .then(r => r.json())
            .then(data => {
                const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
                resultDiv.innerHTML = `<h4>ğŸ’° ${type}</h4><div style="margin:15px 0;padding:15px;background:var(--bg-dark);border-radius:8px;line-height:1.8;">${answer}</div><p style="color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ æƒ³äº†è§£æ›´å¤šï¼Ÿæ·»åŠ å¾®ä¿¡è·å–1v1è¯¦ç»†æŒ‡å¯¼</p><div style="margin-top:20px;padding-top:15px;border-top:1px solid var(--border);"><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡ï¼Œè·å–1v1è¯¦ç»†æŒ‡å¯¼</button></div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<h4>ğŸ’° ${type}</h4><p>ç½‘ç»œé—®é¢˜ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½</p><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡</button></div>`;
            });
        }
        
        function getBudget() {
            const type = document.getElementById('budget-area').value;
            const gender = document.getElementById('budget-room').value;
            const desc = document.getElementById('budget-style').value;
            const resultDiv = document.getElementById('budget-result');
            resultDiv.innerHTML = '<div style="text-align:center;padding:30px;"><div class="loading-spinner"></div><p style="margin-top:15px;">AIæ­£åœ¨åˆ†æä¸­...</p></div>';
            resultDiv.classList.add('active');
            
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: type, question: desc})
            })
            .then(r => r.json())
            .then(data => {
                const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
                resultDiv.innerHTML = `<h4>ğŸ’• ${type}</h4><div style="margin:15px 0;padding:15px;background:var(--bg-dark);border-radius:8px;line-height:1.8;">${answer}</div><p style="color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ æƒ³äº†è§£æ›´å¤šï¼Ÿæ·»åŠ å¾®ä¿¡è·å–1v1è¯¦ç»†æŒ‡å¯¼</p><div style="margin-top:20px;padding-top:15px;border-top:1px solid var(--border);"><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡ï¼Œè·å–1v1è¯¦ç»†æŒ‡å¯¼</button></div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<h4>ğŸ’• ${type}</h4><p>ç½‘ç»œé—®é¢˜ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½</p><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡</button></div>`;
            });
        }
        
        function getStorage() {
            const type = document.getElementById('storage-room').value;
            const desc = document.getElementById('storage-family').value;
            const resultDiv = document.getElementById('storage-result');
            resultDiv.innerHTML = '<div style="text-align:center;padding:30px;"><div class="loading-spinner"></div><p style="margin-top:15px;">AIæ­£åœ¨åˆ†æä¸­...</p></div>';
            resultDiv.classList.add('active');
            
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: type, question: desc})
            })
            .then(r => r.json())
            .then(data => {
                const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
                resultDiv.innerHTML = `<h4>â›©ï¸ ${type}</h4><div style="margin:15px 0;padding:15px;background:var(--bg-dark);border-radius:8px;line-height:1.8;">${answer}</div><p style="color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ æƒ³äº†è§£æ›´å¤šï¼Ÿæ·»åŠ å¾®ä¿¡è·å–1v1ç°åœºå ªèˆ†</p><div style="margin-top:20px;padding-top:15px;border-top:1px solid var(--border);"><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡ï¼Œè·å–1v1ç°åœºå ªèˆ†</button></div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<h4>â›©ï¸ ${type}</h4><p>ç½‘ç»œé—®é¢˜ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½</p><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡</button></div>`;
            });
        }
        
        function initStyleTest() {
            styleAnswers = [];
            const container = document.getElementById('style-questions');
            container.innerHTML = styleQuestions.map((q, i) => `<div class="form-group"><label>${i+1}. ${q.q}</label><select onchange="styleAnswers[${i}]=this.value"><option value="">è¯·é€‰æ‹©</option>${q.options.map(o => `<option value="${o}">${o}</option>`).join('')}</select></div>`).join('');
            document.getElementById('style-btn').style.display = 'block';
            document.getElementById('style-result').style.display = 'none';
        }
        
        function submitStyle() {
            const type = document.getElementById('style-room').value;
            const desc = document.getElementById('style-desc').value;
            const resultDiv = document.getElementById('style-result');
            resultDiv.innerHTML = '<div style="text-align:center;padding:30px;"><div class="loading-spinner"></div><p style="margin-top:15px;">AIæ­£åœ¨åˆ†æä¸­...</p></div>';
            resultDiv.classList.add('active');
            
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: type, question: desc})
            })
            .then(r => r.json())
            .then(data => {
                const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
                resultDiv.innerHTML = `<h4>ğŸ”¯ ${type}</h4><div style="margin:15px 0;padding:15px;background:var(--bg-dark);border-radius:8px;line-height:1.8;">${answer}</div><p style="color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ æƒ³äº†è§£æ›´å¤šï¼Ÿæ·»åŠ å¾®ä¿¡é¢„çº¦æ³•äº‹</p><div style="margin-top:20px;padding-top:15px;border-top:1px solid var(--border);"><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡ï¼Œé¢„çº¦æ³•äº‹</button></div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<h4>ğŸ”¯ ${type}</h4><p>ç½‘ç»œé—®é¢˜ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½</p><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡</button></div>`;
            });
        }
        
        function getLight() {
            const stage = document.getElementById('light-room').value;
            const concern = document.getElementById('light-orientation').value;
            const desc = document.getElementById('light-description').value;
            const resultDiv = document.getElementById('light-result');
            resultDiv.innerHTML = '<div style="text-align:center;padding:30px;"><div class="loading-spinner"></div><p style="margin-top:15px;">AIæ­£åœ¨åˆ†æä¸­...</p></div>';
            resultDiv.classList.add('active');
            
            fetch('/api/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: concern + '(è£…ä¿®é£æ°´)', question: desc || stage})
            })
            .then(r => r.json())
            .then(data => {
                const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
                resultDiv.innerHTML = `<h4>ğŸ¨ ${concern}</h4><div style="margin:15px 0;padding:15px;background:var(--bg-dark);border-radius:8px;line-height:1.8;">${answer}</div><p style="color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ æƒ³äº†è§£æ›´å¤šï¼Ÿæ·»åŠ å¾®ä¿¡è·å–1v1è¯¦ç»†æŒ‡å¯¼</p><div style="margin-top:20px;padding-top:15px;border-top:1px solid var(--border);"><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡ï¼Œè·å–1v1è¯¦ç»†æŒ‡å¯¼</button></div>`;
            })
            .catch(err => {
                resultDiv.innerHTML = `<h4>ğŸ¨ ${concern}</h4><p>ç½‘ç»œé—®é¢˜ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½</p><button onclick="document.getElementById('lead-popup').classList.add('active')" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:8px;color:#111;font-weight:500;cursor:pointer;">ğŸ“± æ·»åŠ å¾®ä¿¡</button></div>`;
            });
        }
        
        function showLoading() { document.getElementById('loading').classList.add('active'); }
        function hideLoading() { document.getElementById('loading').classList.remove('active'); }
        function showResult(id, html) {
            document.getElementById(id).innerHTML = html;
            document.getElementById(id).classList.add('active');
        }
        
        function submitTalisman() {
            const type = document.getElementById('talisman-type').value;
            const name = document.getElementById('talisman-name').value;
            const birth = document.getElementById('talisman-birth').value;
            const wechat = document.getElementById('talisman-wechat').value;
            
            if (!name || !wechat) return alert('è¯·å¡«å†™å§“åå’Œå¾®ä¿¡');
            
            showLoading();
            
            const info = 'ğŸ“¿ è¯·ç¬¦\nç±»å‹: ' + type + '\nå§“å: ' + name + '\nå‡ºç”Ÿ: ' + birth + '\nå¾®ä¿¡: ' + wechat;
            
            setTimeout(function() {
                hideLoading();
                showResult('talisman-result', '<h4>âœ… è¯·ç¬¦å·²æäº¤</h4><p style="color:var(--text-muted);font-size:0.85rem;margin-top:10px;">ç¬¦å’’éœ€è¦æ ¹æ®æ‚¨çš„ä¿¡æ¯å®šåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨24å°æ—¶å†…é€šè¿‡å¾®ä¿¡ä¸æ‚¨ç¡®è®¤è¯¦æƒ…ã€‚</p><div style="margin-top:15px;padding:12px;background:var(--bg-dark);border-radius:8px;"><p style="font-size:0.8rem;color:var(--text-muted);margin-bottom:8px;">ğŸ“‹ ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¤åˆ¶ä¿¡æ¯ï¼š</p><button onclick="var t=document.getElementById(\'copytxt_talisman\');t.select();document.execCommand(\'copy\');this.innerText=\'âœ… å·²å¤åˆ¶ï¼\';this.style.background=\'#4CAF50\'" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:6px;color:#111;font-weight:500;cursor:pointer;">ğŸ“‹ ä¸€é”®å¤åˆ¶è¯·ç¬¦ä¿¡æ¯</button><textarea id="copytxt_talisman" style="opacity:0;position:absolute;z-index:-1">' + info + '</textarea></div>');
                
                document.getElementById('talisman-name').value = '';
                document.getElementById('talisman-birth').value = '';
                document.getElementById('talisman-wechat').value = '';
            }, 600);
        }
        
        function submitSupport() {
            const name = document.getElementById('support-name').value;
            const wechat = document.getElementById('support-wechat').value;
            const type = document.getElementById('support-type').value;
            const desc = document.getElementById('support-desc').value;
            
            if (!name || !wechat || !desc) return alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
            
            showLoading();
            
            const info = 'ğŸ“¥ æ–°å’¨è¯¢\nå§“å: ' + name + '\nå¾®ä¿¡: ' + wechat + '\nç±»å‹: ' + type + '\né—®é¢˜: ' + desc;
            
            setTimeout(function() {
                hideLoading();
                showResult('support-result', '<h4>âœ… å’¨è¯¢å·²æäº¤</h4><p style="color:var(--text-muted);font-size:0.85rem;margin-top:10px;">æ„Ÿè°¢æ‚¨çš„ä¿¡ä»»ï¼æˆ‘ä»¬å°†åœ¨24å°æ—¶å†…é€šè¿‡å¾®ä¿¡ä¸æ‚¨è”ç³»ã€‚</p><div style="margin-top:15px;padding:12px;background:var(--bg-dark);border-radius:8px;"><p style="font-size:0.8rem;color:var(--text-muted);margin-bottom:8px;">ğŸ“‹ ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¤åˆ¶ä¿¡æ¯ï¼š</p><button onclick="var t=document.getElementById(\'copytxt\');t.select();document.execCommand(\'copy\');this.innerText=\'âœ… å·²å¤åˆ¶ï¼\';this.style.background=\'#4CAF50\'" style="width:100%;padding:10px;background:var(--primary);border:none;border-radius:6px;color:#111;font-weight:500;cursor:pointer;">ğŸ“‹ ä¸€é”®å¤åˆ¶å’¨è¯¢ä¿¡æ¯</button><textarea id="copytxt" style="opacity:0;position:absolute;z-index:-1">' + info + '</textarea></div>');
                
                document.getElementById('support-name').value = '';
                document.getElementById('support-wechat').value = '';
                document.getElementById('support-desc').value = '';
            }, 600);
        }
    </script>
    <!-- æ‚¬æµ®å’¨è¯¢æŒ‰é’® -->
    <div class="float-btn" onclick="toggleAIChatWidget()" style="position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;box-shadow:0 4px 20px rgba(212,175,55,0.4);z-index:9998;">ğŸ’¬</div>
    <div class="top-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})">â†‘</div>
    
    <!-- æ—§ç‰ˆèŠå¤©çª—å£ - å·²ç¦ç”¨ -->
    <div class="chat-modal" id="chat-modal">
        <div class="chat-header">
            <span>ğŸ® ä¸€å®…ä¸€å¥ AIåŠ©æ‰‹</span>
            <div class="chat-close" onclick="toggleAIChat()">âœ•</div>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-msg bot">æ‚¨å¥½ï¼æˆ‘æ˜¯AIå°åŠ©æ‰‹ ğŸ˜Š<br>è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ</div>
        </div>
        <div class="chat-options" id="chat-options">
            <div class="chat-opt" onclick="chatReply('è´¢è¿äº‹ä¸š')">ğŸ’° è´¢è¿äº‹ä¸š</div>
            <div class="chat-opt" onclick="chatReply('å§»ç¼˜æ„Ÿæƒ…')">ğŸ’• å§»ç¼˜æ„Ÿæƒ…</div>
            <div class="chat-opt" onclick="chatReply('æˆ¿å­é£æ°´')">ğŸ  æˆ¿å­é£æ°´</div>
            <div class="chat-opt" onclick="chatReply('ç¥–åŸé˜´å®…')">â›©ï¸ ç¥–åŸé˜´å®…</div>
            <div class="chat-opt" onclick="chatReply('é£æ°´æ³•äº‹')">ğŸ”¯ é£æ°´æ³•äº‹</div>
            <div class="chat-opt" onclick="chatReply('éšä¾¿çœ‹çœ‹')">ğŸ‘€ éšä¾¿çœ‹çœ‹</div>
        </div>
    </div>
    
    <!-- å·¥å…·å®Œæˆåå¼•å¯¼å¼¹çª— -->
    <div class="lead-popup" id="lead-popup">
        <div class="lead-box">
            <h3>ğŸ é¢†å–å®Œæ•´é£æ°´æŠ¥å‘Š</h3>
            <img src="images/wechat-qr.jpg" style="width:180px;margin:15px auto;display:block;border-radius:8px;" alt="å¾®ä¿¡äºŒç»´ç ">
            <p>é•¿æŒ‰è¯†åˆ«äºŒç»´ç  Â· æ·»åŠ å¾®ä¿¡</p>
            <div class="lead-close" onclick="document.getElementById('lead-popup').classList.remove('active')">æš‚ä¸éœ€è¦</div>
        </div>
    </div>
    
    <script>
    // AIå®¢æœé€»è¾‘
    let chatStep = 0;
    let userData = {};
    
    function toggleAIChat() {
        const m = document.getElementById('chat-modal');
        m.classList.toggle('active');
    }
    
    function chatReply(msg) {
        const ms = document.getElementById('chat-messages');
        ms.innerHTML += '<div class="chat-msg user">' + msg + '</div>';
        
        if (chatStep === 0) {
            if (msg.indexOf('éšä¾¿çœ‹çœ‹') > -1) {
                ms.innerHTML += '<div class="chat-msg bot">å¥½çš„ï¼æ‚¨å¯ä»¥å…ˆä½“éªŒæˆ‘ä»¬çš„å…è´¹å·¥å…·ï¼š<br>â€¢ æˆ·å‹åˆ†æ â€¢ é£æ°´é…è‰²<br>â€¢ é¢„ç®—è®¡ç®—<br><br>ç‚¹å‡»ä¸Šæ–¹å¡ç‰‡å³å¯ï½</div>';
                chatStep = 99;
            } else {
                // è´¢è¿/å§»ç¼˜/æˆ¿å­/ç¥–åŸ - éƒ½å¼•å¯¼åŠ å¾®ä¿¡
                ms.innerHTML += '<div class="chat-msg bot">å¥½çš„ï¼' + msg + 'æ–¹é¢çš„é—®é¢˜æˆ‘å¤§æ¦‚äº†è§£äº†ï½<br><br>ä¸ºäº†ç»™æ‚¨æ›´ç²¾å‡†çš„å»ºè®®ï¼Œ<br>æ–¹ä¾¿åŠ å¾®ä¿¡è¯¦ç»†æ²Ÿé€šå—ï¼Ÿ<br><br><button onclick="document.getElementById(\'lead-popup\').classList.add(\'active\');toggleAIChat();" style="background:var(--primary);border:none;padding:8px 16px;border-radius:20px;cursor:pointer;">ğŸ“± åŠ å¾®ä¿¡è¯¦èŠ</button></div>';
                chatStep = 10;
            }
        } else if (chatStep === 1) {
            ms.innerHTML += '<div class="chat-msg bot">æ˜ç™½ï¼ä¸ºäº†ç»™æ‚¨æ›´ç²¾å‡†çš„å»ºè®®ï¼Œ<br>æ–¹ä¾¿åŠ å¾®ä¿¡è¯¦ç»†æ²Ÿé€šå—ï¼Ÿ<br><br><button onclick="document.getElementById(\'lead-popup\').classList.add(\'active\');toggleAIChat();" style="background:var(--primary);border:none;padding:8px 16px;border-radius:20px;cursor:pointer;">ğŸ“± åŠ å¾®ä¿¡è¯¦èŠ</button></div>';
            chatStep = 10;
        } else if (chatStep === 2) {
            ms.innerHTML += '<div class="chat-msg bot">æ‚¨å¯ä»¥ï¼š<br>1. å…ˆç”¨å…è´¹å·¥å…·æµ‹è¯•<br>2. æˆ–ç›´æ¥ <button onclick="document.getElementById(\'modal-support\').classList.add(\'active\');toggleAIChat();" style="background:var(--primary);border:none;padding:8px 16px;border-radius:20px;cursor:pointer;">é¢„çº¦çœŸäººå’¨è¯¢</button></div>';
            chatStep = 99;
        }
        
        ms.scrollTop = ms.scrollHeight;
    }
    </script>
    
    <!-- AIèŠå¤©ç»„ä»¶ -->
    <div id="ai-chat-widget" style="position:fixed;bottom:20px;right:20px;z-index:9999;display:none;">
        <div style="width:360px;height:480px;background:var(--bg-dark);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.5);display:flex;flex-direction:column;border:1px solid var(--border);">
            <div style="padding:16px;background:var(--primary);border-radius:16px 16px 0 0;display:flex;justify-content:space-between;align-items:center;">
                <span style="font-weight:600;color:#111;">ğŸ’¬ AIé£æ°´åŠ©æ‰‹</span>
                <span onclick="toggleAIChatWidget()" style="cursor:pointer;font-size:20px;color:#111;">âœ•</span>
            </div>
            <div id="chat-messages" style="flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;">
                <div class="chat-msg bot">æ‚¨å¥½ï¼æˆ‘æ˜¯ã€Œä¸€å®…ä¸€å¥ã€AIé£æ°´åŠ©æ‰‹ ğŸ®<br>æ–°ç”¨æˆ·å¯<strong>å…è´¹3æ¬¡</strong>æé—®ï½<br>æ·±åº¦åˆ†æï¼ˆÂ¥9.9ï¼‰æ›´è¯¦ç»†å“¦</div>
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
                    <button onclick="quickAsk('æˆ‘æƒ³ç®—ç®—è´¢è¿')" style="background:var(--bg-card);border:1px solid var(--border);color:var(--text-muted);padding:6px 12px;border-radius:15px;font-size:0.8rem;cursor:pointer;">ğŸ’° è´¢è¿</button>
                    <button onclick="quickAsk('æˆ‘æƒ³çœ‹å§»ç¼˜')" style="background:var(--bg-card);border:1px solid var(--border);color:var(--text-muted);padding:6px 12px;border-radius:15px;font-size:0.8rem;cursor:pointer;">ğŸ’• å§»ç¼˜</button>
                    <button onclick="quickAsk('å¸®æˆ‘çœ‹çœ‹æˆ¿å­')" style="background:var(--bg-card);border:1px solid var(--border);color:var(--text-muted);padding:6px 12px;border-radius:15px;font-size:0.8rem;cursor:pointer;">ğŸ  æˆ¿å­</button>
                    <button onclick="quickAsk('çŠ¯å¤ªå²æ€ä¹ˆåŠ')" style="background:var(--bg-card);border:1px solid var(--border);color:var(--text-muted);padding:6px 12px;border-radius:15px;font-size:0.8rem;cursor:pointer;">ğŸ å¤ªå²</button>
                </div>
            </div>
            <div style="padding:12px;border-top:1px solid var(--border);display:flex;gap:8px;">
                <input id="chat-input" type="text" placeholder="é—®é£æ°´é—®é¢˜..." style="flex:1;padding:10px;border-radius:20px;border:1px solid var(--border);background:var(--bg);color:var(--text);" onkeypress="if(event.key==='Enter')sendChatMessage()">
                <button onclick="sendChatMessage()" style="padding:10px 16px;background:var(--primary);border:none;border-radius:20px;cursor:pointer;color:#111;font-weight:600;">å‘é€</button>
            </div>
        </div>
    </div>
    <div id="chat-float-btn" onclick="toggleAIChatWidget()" style="position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;box-shadow:0 4px 20px rgba(212,175,55,0.4);z-index:9998;">
        ğŸ’¬
    </div>
    <script>
    let chatHistory = [];
    
    function toggleAIChatWidget() {
        const w = document.getElementById('ai-chat-widget');
        const b = document.getElementById('chat-float-btn');
        if(w.style.display === 'none') {
            w.style.display = 'block';
            b.style.display = 'none';
        } else {
            w.style.display = 'none';
            b.style.display = 'flex';
        }
    }
    
    function quickAsk(q) {
        document.getElementById('chat-input').value = q;
        sendChatMessage();
    }
    
    // è®°å½•å¯¹è¯æ¬¡æ•°
    let chatCount = parseInt(localStorage.getItem('aiChatCount') || '0');
    let isPaid = localStorage.getItem('aiPaid') === 'true';
    
    // ä»æœåŠ¡å™¨æ£€æŸ¥ä»˜è´¹çŠ¶æ€
    (async function syncPaidStatus() {
        const user = getUser();
        if (user && user.id && supabase) {
            try {
                const { data } = await supabase.from('users').select('is_paid').eq('id', user.id).single();
                if (data && data.is_paid) {
                    isPaid = true;
                    localStorage.setItem('aiPaid', 'true');
                }
            } catch(e) {}
        }
    })();
    
    localStorage.setItem('aiChatCount', chatCount);
    console.log('ğŸ“Š AIèŠå¤©å·²å¯åŠ¨ï¼Œå…è´¹æ¬¡æ•°:', 3 - chatCount, 'å·²ä»˜è´¹:', isPaid);
    
    function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const msg = input.value.trim();
        if(!msg) return;
        
        const ms = document.getElementById('chat-messages');
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦ä»˜è´¹
        if (chatCount >= 3 && !isPaid) {
            ms.innerHTML += '<div class="chat-msg user">' + msg + '</div>';
            ms.innerHTML += '<div class="chat-msg bot">ğŸ’¡ æ‚¨å·²ä½¿ç”¨3æ¬¡å…è´¹æé—®ï½<br><br>è§£é”<strong>æ·±åº¦åˆ†æ</strong>ï¼ˆè¯¦ç»†+åŒ–è§£æ–¹æ¡ˆï¼‰ï¼Œåªéœ€<strong>Â¥9.9</strong><br><br><button onclick="document.getElementById(\'lead-popup\').classList.add(\'active\');" style="background:var(--primary);border:none;padding:10px 20px;border-radius:20px;color:#111;font-weight:600;cursor:pointer;">ğŸ’° æ”¯ä»˜Â¥9.9è§£é”</button> <button onclick="showRedeem()" style="background:var(--bg-dark);border:1px solid var(--border);padding:10px 20px;border-radius:20px;color:var(--text);cursor:pointer;">ğŸ« å…‘æ¢ç </button></div>';
            
            function showRedeem() {
                const code = prompt('è¯·è¾“å…¥å…‘æ¢ç ï¼š');
                if(code && code.toLowerCase() === 'vip2026') {
                    localStorage.setItem('aiPaid','true');
                    isPaid = true;
                    ms.innerHTML += '<div class="chat-msg bot">âœ… å…‘æ¢æˆåŠŸï¼æ‚¨å·²è§£é”æ·±åº¦åˆ†æï¼Œç»§ç»­æé—®å§ï½</div>';
                } else if(code) {
                    ms.innerHTML += '<div class="chat-msg bot">âŒ å…‘æ¢ç é”™è¯¯ï¼Œè¯·è”ç³»å®¢æœè·å–æ­£ç¡®å…‘æ¢ç </div>';
                }
                ms.scrollTop = ms.scrollHeight;
            }
            ms.scrollTop = ms.scrollHeight;
            return;
        }
        
        ms.innerHTML += '<div class="chat-msg user">' + msg + '</div>';
        input.value = '';
        
        const type = (chatCount >= 3) ? 'æ·±åº¦åˆ†æ' : 'åŸºç¡€å’¨è¯¢';
        ms.innerHTML += '<div class="chat-msg bot" style="background:var(--bg);">' + ((chatCount >= 3) ? 'ğŸ” æ·±åº¦åˆ†æä¸­...' : 'ğŸ¤” AIæ€è€ƒä¸­...') + '</div>';
        ms.scrollTop = ms.scrollHeight;
        
        // ç»Ÿè®¡å¯¹è¯æ¬¡æ•°
        chatCount++;
        localStorage.setItem('aiChatCount', chatCount);
        
        chatHistory.push({role:'user', content:msg});
        
        fetch('/api/chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({type:'å¯¹è¯å’¨è¯¢', question: msg, history: chatHistory})
        })
        .then(r => r.json())
        .then(data => {
            ms.removeChild(ms.lastChild);
            const answer = data.answer || 'æŠ±æ­‰ï¼ŒAIæ­£åœ¨ä¼‘æ¯ï¼Œè¯·åŠ å¾®ä¿¡è¯¦è°ˆï½';
            ms.innerHTML += '<div class="chat-msg bot">' + answer + '</div>';
            chatHistory.push({role:'assistant', content:answer});
            ms.scrollTop = ms.scrollHeight;
        })
        .catch(err => {
            ms.removeChild(ms.lastChild);
            ms.innerHTML += '<div class="chat-msg bot">ç½‘ç»œé—®é¢˜ï¼Œè¯·ç¨åå†è¯•ï½</div>';
            ms.scrollTop = ms.scrollHeight;
        });
    }
    </script>
</body>
</html>